<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Table Maker</title>
    <style>
        body {
            margin: 0px;
            padding: 0px;
            box-sizing: border-box;
            min-height: 100vh;
            width: 100vw;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 1rem;
        }

        #info {
            inline-size: 80vw;
            overflow-wrap: break-word;
        }
    </style>
    <script src="TableMaker.js" defer></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
</head>

<body class="container">
    <h1 class="display-2">TableMaker Demo</h1>

    <div class="row">
        <div class="btn-group" role="group">
            <button onclick="showRaw(this)" class="btn btn-outline-danger" disabled>Show Raw Data</button>
            <button onclick="makeTable()" class="btn btn-outline-secondary" disabled>Make Table</button>
        </div>
    </div>

    <div class="row">
        <p id="info" hidden></p>
    </div>

    <div id="paginator-container" class="row"></div>
    <div id="table-container" class="row"></div>

    <script defer>
        //courtesy https://stackoverflow.com/questions/27012854/how-to-change-iso-date-string-to-date-object
        function parseISOString(s) {
        var b = s.split(/\D+/);
        return new Date(Date.UTC(b[0], --b[1], b[2], b[3], b[4], b[5], b[6]));
        }
        // courtesy https://stackoverflow.com/questions/559112/how-to-convert-a-currency-string-to-a-double-with-javascript
        function parseCurrency(currency) {
            return Number(currency.replace(/[^0-9.-]+/g,""));
        }
        let data;

        //first of all any JSON data read in would have to be pre-processed to be "valid", i.e. the difference between a JSON text file and the equivilant POJO
        fetch("./exampleData.json").then(res => res.json()).then(val => {
            data = val;
            let content = "";
            for(let datum of data) {
                datum["registered"] = parseISOString(datum["registered"]);
                datum["balance"] = parseCurrency(datum["balance"]);   
                content += JSON.stringify(datum, null, 2);
            }
            document.querySelector("#info").innerText = content;

            for(let btn of document.querySelectorAll("button")) btn.disabled = false;
        });

        let visible = false;
        let i = 1;

        function showRaw(el) {
            visible = !visible;
            let info = document.querySelector("#info");
            if (visible) {
                info.hidden = false;
                el.innerText = "Hide Raw Data";
            }
            else {
                info.hidden = true;
                el.innerText = "Show Raw Data"
            }
        }

        function makeTable() {
            if (i++ > 1) return;

            NMaker.init(data);

            let pm = new PaginatorMaker({
                id : "newPaginator",
                parentSelector: "#paginator-container",
                pageLength: 5
            });

            let filter = new FilterMaker({
                parentSelector: "#table-container",
                ignore: ["picture", "about"],
                useModifier: true
            });

            let tm = new TableMaker({
                id: "newTable",
                parentSelector: "#table-container",
                sorting: ["balance", "eye color", "name", "age", "registered", "company", "email", "phone", "address"],
                hide: ["about"],
                currency: ["balance"],
                link: [{
                    name: "picture",
                    text: "See picture"
                }]
            });
        }
    </script>
</body>

</html>